<?xml version="1.0" encoding="UTF-8"?>
<!--
  Network Manager - D-Bus System Bus Configuration
  Copyright (C) 2026 Christos A. Daggas
  SPDX-License-Identifier: MIT
  
  This file configures D-Bus system bus permissions for the Network Manager daemon.
  Install to: /usr/share/dbus-1/system.d/
-->
<!DOCTYPE busconfig PUBLIC
  "-//freedesktop//DTD D-BUS Bus Configuration 1.0//EN"
  "http://www.freedesktop.org/standards/dbus/1.0/busconfig.dtd">
<busconfig>
  <!-- Only root can own the service name -->
  <policy user="root">
    <allow own="com.chrisdaggas.NetworkManagerd"/>
    <allow send_destination="com.chrisdaggas.NetworkManagerd"/>
    <allow receive_sender="com.chrisdaggas.NetworkManagerd"/>
  </policy>

  <!-- Allow any user to call methods (Polkit will authorize) -->
  <policy context="default">
    <allow send_destination="com.chrisdaggas.NetworkManagerd"/>
    <allow receive_sender="com.chrisdaggas.NetworkManagerd"/>
    
    <!-- Explicitly allow introspection -->
    <allow send_destination="com.chrisdaggas.NetworkManagerd"
           send_interface="org.freedesktop.DBus.Introspectable"/>
    <allow send_destination="com.chrisdaggas.NetworkManagerd"
           send_interface="org.freedesktop.DBus.Properties"/>
    
    <!-- Allow all manager interface methods (Polkit checks inside) -->
    <allow send_destination="com.chrisdaggas.NetworkManagerd"
           send_interface="com.chrisdaggas.NetworkManager.Manager"/>
    <allow send_destination="com.chrisdaggas.NetworkManagerd"
           send_interface="com.chrisdaggas.NetworkManager.Profiles"/>
    <allow send_destination="com.chrisdaggas.NetworkManagerd"
           send_interface="com.chrisdaggas.NetworkManager.Status"/>
  </policy>

  <!-- System daemon user (if running as non-root service user) -->
  <policy user="cd-network-manager">
    <allow own="com.chrisdaggas.NetworkManagerd"/>
    <allow send_destination="com.chrisdaggas.NetworkManagerd"/>
    <allow receive_sender="com.chrisdaggas.NetworkManagerd"/>
  </policy>
</busconfig>
